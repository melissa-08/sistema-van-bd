<!-- Content Area (sidebar is provided by layout) -->
<div class="flex flex-col gap-6 h-full p-5 w-full">

  <!-- Header: Title + Search -->
  <div class="flex gap-5 items-center w-full shrink-0">
    <h1 class="text-text text-header-1 tracking-narrow shrink-0">
      Aprovar Motoristas
    </h1>
    <div class="flex flex-1 items-center">
      <div class="flex flex-1 items-center gap-[6px] h-[44px] bg-light rounded-[46px] p-6 py-1 overflow-hidden">
        <img src="assets/icons/search-normal.svg" alt="Buscar" class="w-6 h-6 opacity-40" />
        <input
          type="text"
          placeholder="Pesquisar por ID ou Nome"
          class="flex-1 bg-transparent text-body text-subtle-text font-['Work_Sans'] focus:outline-none placeholder:text-subtle-text placeholder:opacity-70"
        />
      </div>
    </div>
  </div>

  <!-- Tabs + Counter -->
  <div class="flex items-center justify-between w-full shrink-0">

    <!-- Connected Button Group -->
    <div class="flex gap-[2px] h-[48px] items-center rounded-[20px] cursor-pointer">
      <!-- Tab: Aguardando -->
      <button
        (click)="switchTab('PENDING')"
        [class]="activeTab() === 'PENDING'
          ? 'flex items-center justify-center gap-2 px-5 py-[10px] rounded-[24px] min-w-[48px] overflow-hidden transition-colors cursor-pointer bg-secondary text-white'
          : 'flex items-center justify-center gap-2 px-5 py-[10px] rounded-l-[24px] rounded-r-[8px] min-w-[48px] overflow-hidden transition-colors cursor-pointer bg-light text-subtle-text hover:bg-accent/20'"
      >
        <img src="assets/icons/clock.svg" alt="" class="w-5 h-5"
          [style.filter]="activeTab() === 'PENDING' ? 'brightness(0) invert(1)' : 'none'"
        />
        <span class="text-[14px] font-medium whitespace-nowrap">Aguardando</span>
      </button>
      <!-- Tab: Rejeitados -->
      <button
        (click)="switchTab('REJECTED')"
        [class]="activeTab() === 'REJECTED'
          ? 'flex items-center justify-center gap-2 px-5 py-[10px] rounded-[24px] min-w-[48px] overflow-hidden transition-colors cursor-pointer bg-secondary text-white'
          : 'flex items-center justify-center gap-2 px-5 py-[10px] rounded-r-[24px] rounded-l-[8px] min-w-[48px] overflow-hidden transition-colors cursor-pointer bg-light text-text hover:bg-accent/20'"
      >
        <img src="assets/icons/close-circle.svg" alt="" class="w-5 h-5"
          [style.filter]="activeTab() === 'REJECTED' ? 'brightness(0) invert(1)' : 'none'"
        />
        <span class="text-[14px] font-medium whitespace-nowrap">Rejeitados</span>
      </button>
    </div>

    <!-- Counter Badge (adapts to active tab) -->
    <div class="flex gap-[10px] h-[48px] items-center justify-center pl-2 pr-5 py-1 bg-light rounded-[12px]">
      <div class="flex items-center justify-center p-1 bg-white rounded-full">
        <img
          [src]="activeTab() === 'PENDING' ? 'assets/icons/clock.svg' : 'assets/icons/close-circle.svg'"
          alt="" class="w-6 h-6"
        />
      </div>
      <div class="flex gap-1 items-center whitespace-nowrap">
        <span class="text-text text-header-3 tracking-narrow">{{ activeTab() === 'PENDING' ? pendingCount() : rejectedCount() }}</span>
        <span class="text-subtle-text text-medium">{{ activeTab() === 'PENDING' ? 'Pendentes' : 'Rejeitados' }}</span>
      </div>
    </div>
  </div>

  <!-- Table Card -->
  <div class="flex flex-1 flex-col gap-[10px] items-end min-h-0 w-full">
    <div class="bg-light flex flex-col gap-[10px] items-start p-6 rounded-[24px] w-full flex-1 overflow-hidden">

      <!-- Table Header -->
      <div class="bg-white flex items-center px-6 py-[14px] rounded-[12px] w-full shrink-0">
        <span class="text-text text-header-3 tracking-narrow flex-[3]">Nome do motorista</span>
        <span class="text-text text-header-3 tracking-narrow flex-[2] text-center">CNH</span>
        <span class="text-text text-header-3 tracking-narrow flex-[1.5] text-center">Status</span>
        <span class="text-text text-header-3 tracking-narrow flex-[2] text-right">{{ activeTab() === 'PENDING' ? 'Ações' : 'Motivo' }}</span>
      </div>

      <!-- Loading State -->
      @if (loading()) {
        <div class="flex items-center justify-center w-full py-10">
          <span class="text-subtle-text text-medium">Carregando...</span>
        </div>
      }

      <!-- Error State -->
      @if (error()) {
        <div class="flex items-center justify-center w-full py-10">
          <span class="text-[#d45959] text-medium">{{ error() }}</span>
        </div>
      }

      <!-- Empty State -->
      @if (!loading() && drivers().length === 0) {
        <div class="flex items-center justify-center w-full py-10">
          <span class="text-subtle-text text-medium">
            {{ activeTab() === 'PENDING' ? 'Nenhum motorista aguardando aprovação.' : 'Nenhum motorista rejeitado.' }}
          </span>
        </div>
      }

      <!-- Table Rows -->
      <div class="flex flex-col w-full overflow-y-auto flex-1">
        @for (driver of drivers(); track driver.id) {
          <!-- Row -->
          <div class="flex items-center px-6 py-[14px] w-full">
            <!-- Driver Info -->
            <div class="flex gap-3 items-center flex-[3]">
              <div class="bg-white flex items-center p-3 rounded-full shrink-0">
                <img src="assets/icons/user.svg" alt="Motorista" class="w-7 h-7" />
              </div>
              <div class="flex flex-col gap-1 justify-center">
                <span class="text-text text-medium leading-tight">{{ driver.name }}</span>
                <span class="text-subtle-text text-[16px] font-medium leading-tight">ID: {{ shortId(driver.id) }}</span>
              </div>
            </div>

            <!-- CNH -->
            <div class="flex flex-col gap-1 justify-center flex-[2] text-center">
              <span class="text-text text-medium leading-tight">{{ driver.cnh }}</span>
              <span class="text-subtle-text text-[16px] font-medium leading-tight">{{ driver.phone }}</span>
            </div>

            <!-- Status -->
            <div class="flex-[1.5] flex justify-center">
              @if (activeTab() === 'PENDING') {
                <app-tag label="Aguardando" variant="warning"></app-tag>
              } @else {
                <app-tag label="Rejeitado" variant="error"></app-tag>
              }
            </div>

            <!-- Action Buttons / Rejection Reason -->
            @if (activeTab() === 'PENDING') {
              <div class="flex gap-3 items-center justify-end flex-[2]">
                <button
                  (click)="approve(driver)"
                  class="flex items-center justify-center gap-2 px-6 py-3 bg-success text-white rounded-[8px] cursor-pointer hover:bg-success/90 transition-colors"
                >
                  <img src="assets/icons/check.svg" alt="" class="w-4 h-4" style="filter: brightness(0) invert(1);" />
                  <span class="text-button-text uppercase">Aprovar</span>
                </button>
                <button
                  (click)="reject(driver)"
                  class="flex items-center justify-center gap-2 px-6 py-3 bg-white text-secondary rounded-[8px] cursor-pointer hover:bg-light transition-colors"
                >
                  <img src="assets/icons/close.svg" alt="" class="w-4 h-4" style="filter: invert(43%) sepia(15%) saturate(1100%) hue-rotate(163deg) brightness(95%) contrast(87%);" />
                  <span class="text-button-text uppercase">Rejeitar</span>
                </button>
              </div>
            } @else {
              <div class="flex-[2] text-right">
                <span class="text-subtle-text text-medium leading-tight" [title]="driver.rejectionReason">
                  {{ driver.rejectionReason || 'Sem motivo informado' }}
                </span>
              </div>
            }
          </div>

          <!-- Divider -->
          <div class="w-full h-[1px] bg-accent/30"></div>
        }
      </div>
    </div>

    <!-- Pagination -->
    @if (totalPages() > 1) {
      <div class="flex gap-[6px] items-start shrink-0">
        <!-- Previous -->
        <button
          (click)="goToPage(currentPage() - 1)"
          [disabled]="currentPage() === 0"
          class="bg-light flex items-center justify-center rounded-[8px] w-[50px] h-[50px] cursor-pointer disabled:opacity-40 disabled:cursor-not-allowed"
        >
          <img src="assets/icons/arrow_back.svg" alt="Anterior" class="w-6 h-6" />
        </button>

        <!-- Page Numbers -->
        <div class="flex gap-[2px] items-center">
          @for (page of pages; track page) {
            <button
              (click)="goToPage(page)"
              class="flex items-center justify-center px-[18px] py-[10px] cursor-pointer transition-colors"
              [class]="page === currentPage()
                ? 'flex items-center justify-center px-[18px] py-[10px] cursor-pointer transition-colors bg-secondary text-white rounded-[8px]'
                : 'flex items-center justify-center px-[18px] py-[10px] cursor-pointer transition-colors bg-light text-subtle-text rounded-[2px] hover:bg-accent/30'"
            >
              <span class="font-google-sans-flex font-medium text-subtitle leading-normal">{{ page + 1 }}</span>
            </button>
          }
        </div>

        <!-- Next -->
        <button
          (click)="goToPage(currentPage() + 1)"
          [disabled]="currentPage() >= totalPages() - 1"
          class="bg-light flex items-center justify-center rounded-[8px] w-[50px] h-[50px] cursor-pointer disabled:opacity-40 disabled:cursor-not-allowed"
        >
          <img src="assets/icons/arrow_forward.svg" alt="Próximo" class="w-6 h-6" />
        </button>
      </div>
    }
  </div>
</div>

<!-- Rejection Modal -->
@if (showRejectModal()) {
  <div class="fixed inset-0 z-50 flex items-center justify-center">
    <!-- Backdrop -->
    <div
      class="absolute inset-0 bg-black/40 backdrop-blur-[12px]"
      (click)="cancelReject()"
    ></div>

    <!-- Modal Card -->
    <div class="relative bg-white rounded-[24px] w-full max-w-[700px] px-[68px] py-[24px] flex flex-col gap-6 items-end z-10 shadow-xl">
      <div class="flex flex-col gap-6 items-start w-full">
        <h2 class="text-text text-header-1 tracking-narrow">Rejeitar Motorista</h2>

        <!-- Motivo input -->
        <div class="flex flex-col gap-[3px] items-start w-full">
          <label class="text-text text-[14px] font-google-sans-flex font-medium w-full">Motivo da rejeição</label>
          <textarea
            #rejectReasonInput
            placeholder="Descreva o motivo da rejeição..."
            rows="4"
            (input)="rejectReason = rejectReasonInput.value"
            class="w-full bg-light rounded-[8px] px-4 py-3 text-body text-text font-['Work_Sans'] focus:outline-none placeholder:text-subtle-text resize-none"
          ></textarea>
        </div>
      </div>

      <!-- Buttons -->
      <div class="flex gap-6 items-start">
        <button
          (click)="cancelReject()"
          class="flex items-center justify-center px-6 py-4 bg-light text-text rounded-[8px] cursor-pointer hover:bg-accent/30 transition-colors min-w-[48px]"
        >
          <span class="text-button-text uppercase">Cancelar</span>
        </button>
        <button
          (click)="confirmReject()"
          [disabled]="!rejectReason.trim()"
          class="flex items-center justify-center px-6 py-4 bg-primary text-white rounded-[8px] cursor-pointer hover:bg-primary/90 transition-colors min-w-[48px] disabled:opacity-40 disabled:cursor-not-allowed"
        >
          <span class="text-button-text uppercase">Rejeitar</span>
        </button>
      </div>
    </div>
  </div>
}
